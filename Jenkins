pipeline
{
	agent any
	environment
	{
		DOCKER_CREDENTIALS=credentials('rv')
		Image_Name="vs1ms24mc107/final"
	}
	stages
	{
		stage('chec')
		{
			steps
			{
				git branch:"main", url:"git@github.com:vs1ms24mc107-wq/final.git"
			}
		}
		stage('Build JAR') {
    	steps {
       			 sh 'mvn clean package -DskipTests'
    }
}

		stage('Build image')
		{
			steps
			{
				script{
					dockerImage=docker.build("${Image_Name}:latest")
				}
			}
		}
		stage('push to docker hub')
		{
			steps
			{
				script
				{
					docker.withRegistry("https://index.docker.io/v1/","rv")
					{
						dockerImage.push()
					}
				}
			}
		}
	}
	post
	{
		success
		{
			echo "pipeline successful"
		}
		failure
		{
			echo "pipeline failed"
		}
		always
		{
			echo "cleaning up workspace"
			deleteDir()
		}
	}
}
